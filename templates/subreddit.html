{% extends "base.html" %}
{% from "_macros.html" import render_form %}
{% set active_page = "subreddit" %}
{% set page_title = subreddit.name %}
{% block body_w_flash %}
<div class="col-md-8">
  <h1>{{ subreddit.name }}</h1>
  {% if subreddit.posts %}
    {% for post in subreddit.posts %}
    <div class="well well-sm">
      <div class="pull-left" style="padding-right: 10px;">
        {% if current_user.is_authenticated() %}
          {% set v_stat = post.vote_status() %}
          <i data-dir="up" data-id="{{ post.id }}" class="fa fa-arrow-up vote up {% if v_stat %}enabled{%endif%}"></i>
          <br>
          <i data-dir="down" data-id="{{ post.id }}" class="fa fa-arrow-down vote down {% if not v_stat %}enabled{% endif %}"></i>
        {% else %}
          <a data-dir="up" href="/login" class="fa fa-arrow-up"></a><br><a href="/login" data-dir="down" class="fa fa-arrow-down"></a>
        {% endif %}
      </div>
      <div><a href="{{ post.url }}">{{ post.title }}</a></div>
      <div><a href="{{ post.comments_url }}">12 comments</a> - share - report</div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <b>No one has posted anything yet!</b>
  {% endif %}
</div>
<div class="col-md-4" style="border-left: 1px solid #999;">
  <br />
  <a href="/submit/{{ subreddit.name }}">Submit a new post</a>
</div>
<script>
$(function () {
  $(".vote").click(function (e) {
    var sel = $(this);
    var obj = sel[0];
    sel.toggleClass('enabled');
    if (obj.dataset.dir == "up")
      sel.siblings(".down").removeClass('enabled');
    else
      sel.siblings(".up").removeClass('enabled');
    $.ajax({
      url: "/api/vote/" + obj.dataset.id + "/" + obj.dataset.dir,
    });
  });
});
</script>
{% endblock %}
